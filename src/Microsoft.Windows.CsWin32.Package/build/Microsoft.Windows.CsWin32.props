<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <PropertyGroup>
    <AllowUnsafeBlocks>true</AllowUnsafeBlocks>
  </PropertyGroup>
  
  <ItemGroup>
    <AdditionalFiles Include="NativeMethods.json" Condition="Exists('NativeMethods.json')" />
    <AdditionalFiles Include="NativeMethods.txt" Condition="Exists('NativeMethods.txt')"  />
  </ItemGroup>

  <ItemGroup>
    <!-- Provide the path to the winmds used as input into the analyzer. -->
    <CompilerVisibleProperty Include="CsWin32InputMetadataPaths" />
    <CompilerVisibleProperty Include="CsWin32InputDocPaths" />
  </ItemGroup>

  <Choose>
    <When Condition="'$(VisualStudioVersion)' == '17.0' AND '$(DesignTimeBuild)' == 'True'">
      <ItemGroup>
        <Analyzer Include="$(MSBuildThisFileDirectory)../../analyzers/cs/roslyn40/*.dll" />
      </ItemGroup>
    </When>
    <Otherwise>
      <ItemGroup>
        <Analyzer Include="$(MSBuildThisFileDirectory)../../analyzers/cs/roslyn38/*.dll" />
      </ItemGroup>
    </Otherwise>
  </Choose>

  <Target Name="AssembleCsWin32InputPaths" BeforeTargets="GenerateMSBuildEditorConfigFileCore">
    <!-- Roslyn only allows source generators to see msbuild properties, to lift msbuild items into semicolon-delimited properties. -->
    <PropertyGroup>
      <CsWin32InputMetadataPaths>@(ProjectionMetadataWinmd,'|')</CsWin32InputMetadataPaths>
      <CsWin32InputDocPaths>@(ProjectionDocs,'|')</CsWin32InputDocPaths>
    </PropertyGroup>
  </Target>
</Project>
